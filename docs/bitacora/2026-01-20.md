# Bitácora 2026-01-20: Middleware de Rol y Panel Admin

## Objetivo

Implementar un sistema de protección de rutas basado en roles y configurar un usuario administrador definitivo con acceso a un panel inicial.

## Cambios Realizados

### 1. Seeder de Admin Definitivo

- **Archivo**: `database/seeders/AdminUserSeeder.php`.
- **Nuevo Admin**: `pablosevillanoa90@gmail.com`.
- **Lógica de Migración**: El seeder ahora busca si existía el admin antiguo (`admin@valtherion.local`) y lo actualiza al nuevo correo. Si no existe ninguno, crea el nuevo.
- **Seguridad**: Solo asigna la contraseña `12345678` si el usuario es creado desde cero.
- **Valores**:
    - `name`: Pablo Sevillano
    - `role`: admin
    - `plan`: premium

### 2. Middleware `EnsureRole`

- **Comando**: `php artisan make:middleware EnsureRole`.
- **Archivo**: `app/Http/Middleware/EnsureRole.php`.
- **Funcionalidad**: Permite restringir acceso a rutas según el campo `role` del usuario. Si el usuario no tiene el rol especificado, devuelve un `403`.

### 3. Registro de Middleware (Laravel 12)

- Se registró el alias `'role'` en `bootstrap/app.php`.

### 4. Ruta y Vista de Administración

- **Ruta**: Se añadió `/admin` en `routes/web.php`, protegida por `auth` y `role:admin`.
- **Vista**: Creada en `resources/views/admin/index.blade.php` con un diseño mínimo inicial.

### 5. Ajuste Estético de Login y Registro

- Se creó un layout específico `auth.blade.php` para las páginas de autenticación.
- Se configuró un estilo oscuro integral (fondo negro/zinc-950, tarjetas zinc-900, bordes zinc-800).
- Se actualizaron los componentes de formulario (`text-input`, `input-label`, `primary-button`) para que sean estéticamente coherentes con el tema oscuro del proyecto.
- Se sustituyó el logo de Laravel por el logo oficial del proyecto en todos los componentes de autenticación.
- **Extra**: Se tradujeron todos los textos y botones de las páginas de autenticación (Login, Registro, Olvido de contraseña) al castellano.

### 6. Ajustes en Welcome Hero

- Se centró el logo en la sección Hero de la página de inicio pública mediante clases de Bootstrap (`d-block mx-auto`).

## Verificación

- **Tinker**: Se comprobó que el usuario `pablosevillanoa90@gmail.com` existe y tiene los campos `role='admin'` y `plan='premium'`.
- **BD**: Base de datos SQLite comprobada mediante comandos de consola.
- **Navegador**: Se verificó visualmente que `/login` y `/register` cargan con el nuevo estilo oscuro, el logo correcto y en castellano. Se confirmó que el logo del Welcome está centrado.

## Comandos Ejecutados

```bash
php artisan db:seed --class=AdminUserSeeder
php artisan make:middleware EnsureRole
```

## Credenciales de Acceso (Desarrollo)

- **Email**: pablosevillanoa90@gmail.com
- **Password**: 12345678
- **Acceso**: [http://localhost:8000/admin](http://localhost:8000/admin) (requiere login)

### 7. Estructura Base: Home Juego (Zona Logueada)

- Se implementó un nuevo layout modular para la zona de juego: `layouts/game/app.blade.php`.
- **Diseño No-Scroll**: Estructura fija de `100vh` con un contenedor central `calc(100vh - 128px)` y `overflow: hidden`.
- **Doble Navbar**:
    - **Superior**: Contiene accesos rápidos (Tienda/Inventario), Logo centrado y Perfil/Ajustes.
    - **Inferior**: Navegación principal (Home, Misiones, Peleas, Chat).
- **Iconografía**: Uso de Bootstrap Icons para una interfaz limpia y optimizada para móviles.
- **Rutas Prohibidas**: Se crearon rutas placeholder protegidas por `auth` para todas las secciones del juego.

## Verificación

- **Navegador**: Verificado que `/home` carga el nuevo layout sin scroll. Los enlaces navegan correctamente entre las secciones placeholder.
- **Estilo**: Fondo negro y texto blanco aplicado consistentemente.

## Siguientes Pasos

- Implementar la lógica de Misiones y el sistema de combate base.
