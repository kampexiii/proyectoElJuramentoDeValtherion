# Bitácora 2026-01-20: Middleware de Rol y Panel Admin

## Objetivo

Implementar un sistema de protección de rutas basado en roles y configurar un usuario administrador definitivo con acceso a un panel inicial.

## Cambios Realizados

### 1. Seeder de Admin Definitivo

- **Archivo**: `database/seeders/AdminUserSeeder.php`.
- **Nuevo Admin**: `pablosevillanoa90@gmail.com`.
- **Lógica de Migración**: El seeder ahora busca si existía el admin antiguo (`admin@valtherion.local`) y lo actualiza al nuevo correo. Si no existe ninguno, crea el nuevo.
- **Seguridad**: Solo asigna la contraseña `12345678` si el usuario es creado desde cero.
- **Valores**:
    - `name`: Pablo Sevillano
    - `role`: admin
    - `plan`: premium

### 2. Middleware `EnsureRole`

- **Comando**: `php artisan make:middleware EnsureRole`.
- **Archivo**: `app/Http/Middleware/EnsureRole.php`.
- **Funcionalidad**: Permite restringir acceso a rutas según el campo `role` del usuario. Si el usuario no tiene el rol especificado, devuelve un `403`.

### 3. Registro de Middleware (Laravel 12)

- Se registró el alias `'role'` en `bootstrap/app.php`.

### 4. Ruta y Vista de Administración

- **Ruta**: Se añadió `/admin` en `routes/web.php`, protegida por `auth` y `role:admin`.
- **Vista**: Creada en `resources/views/admin/index.blade.php` con un diseño mínimo inicial.

## Verificación

- **Tinker**: Se comprobó que el usuario `pablosevillanoa90@gmail.com` existe y tiene los campos `role='admin'` y `plan='premium'`.
- **BD**: Base de datos SQLite comprobada mediante comandos de consola.

## Comandos Ejecutados

```bash
php artisan db:seed --class=AdminUserSeeder
php artisan make:middleware EnsureRole
```

## Credenciales de Acceso (Desarrollo)

- **Email**: pablosevillanoa90@gmail.com
- **Password**: 12345678
- **Acceso**: [http://localhost:8000/admin](http://localhost:8000/admin) (requiere login)

## Siguientes Pasos

- Empezar con la lógica de gestión de usuarios desde el panel admin.
