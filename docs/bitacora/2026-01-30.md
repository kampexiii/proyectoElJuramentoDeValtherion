# 2026-01-30

Objetivo:

- Equipamiento del personaje (equipar/desequipar) + montura e inventario base.

Archivos tocados:

- app/Http/Controllers/CharacterController.php
- app/Http/Controllers/CharacterEquipmentController.php
- app/Models/Character.php
- app/Models/CharacterEquipment.php
- app/Models/CharacterItem.php
- app/Models/Item.php
- app/Models/Mount.php
- database/migrations/2026_01_23_091210_create_items_table.php
- database/migrations/2026_01_23_091212_create_equipment_slots_table.php
- database/migrations/2026_01_23_091213_create_character_items_table.php
- database/migrations/2026_01_29_220010_create_mounts_table.php
- database/migrations/2026_01_29_220011_add_mount_id_to_characters_table.php
- database/seeders/DatabaseSeeder.php
- database/seeders/MountSeeder.php
- public/assets/sprites/razas/.gitkeep
- resources/views/game/character/create.blade.php
- resources/views/game/character/edit.blade.php
- resources/views/game/inventario.blade.php
- resources/views/game/tienda.blade.php
- routes/web.php

Comandos ejecutados:

- git status --porcelain
- git branch --show-current
- git log --oneline -5
- php artisan route:list (falló: php no disponible)
- rg -n "items|equipment|inventory|mount" database/migrations

Verificación:

- Pendiente: Verificado con tinker y comprobando en BD (SQLite/DBeaver) el equipamiento e inventario (php no disponible en el entorno).

No se tocó .env ni database.sqlite.

---

Ajustes extra del viernes:

- Editar personaje sin cambios de nombre/raza/stats; stats mostradas con barras y cálculo de equipo.
- Equipar solo desde inventario y bloqueo si supera máximos.
- Migraciones de items/equipment/inventario con guardas si la tabla ya existe.

---

Tienda (diagnóstico sin tocar BD) + Ajustes mobile compactos:

- Tienda: filtros tolerantes a tipos/slots en español (arma/armadura/casco/anillo/colgante/montura) para mostrar items ya existentes.
- Ajustes: UI más compacta en mobile para que no se tape con la navbar inferior.

Archivos tocados:

- app/Services/WeeklyShopService.php
- resources/views/game/ajustes.blade.php
- resources/css/game/components/ajustes.css

Comandos ejecutados:

- git status --porcelain
- git branch --show-current
- git log --oneline -3
- php artisan --version (falló: php no disponible)
- php artisan route:list (falló: php no disponible)
- php artisan tinker --execute=... (falló: php no disponible)
- npm run build (OK)
- php artisan serve (falló: php no disponible)

Verificación:

- Pendiente en entorno local con php: comprobar conteo de items y vista de tienda.
- Ajustes: pendiente verificar en navegador móvil (sin solape con navbar).

No se tocó .env ni database.sqlite.

---

Tienda (seeder fallando por rarities) + corrección:

- El seeder de items fallaba por FK a tabla `rarities` inexistente.
- Se añadió migración mínima `rarities` y el seeder ahora rellena `rarity_id` si existe.
- Ajustes: compactación adicional en mobile.

Archivos tocados:

- database/migrations/2026_01_29_233000_create_rarities_table.php
- database/seeders/ShopItemsSeeder.php
- resources/css/game/components/ajustes.css

Comandos ejecutados:

- git status --porcelain
- git branch --show-current
- git log --oneline -3
- php artisan --version (falló: php no disponible)
- php artisan route:list (falló: php no disponible)

Verificación:

- Pendiente ejecutar migrate y repetir el seeder en entorno con php.

No se tocó .env ni database.sqlite.

---

Tienda (mobile en cuadrícula) + Ajustes más compactos:

- Tienda: en móvil, los objetos del mismo tipo se muestran en una sola fila con 3 cajas pequeñas y legibles.
- Ajustes: reducción adicional de gaps, padding y tipografías en desktop y mobile sin cortar contenido.

Archivos tocados:

- resources/css/game/components/tienda.css
- resources/css/game/components/ajustes.css

Comandos ejecutados:

- git status --porcelain

Verificación:

- Pendiente validar en móvil real que no hay cortes y se lee correctamente.

No se tocó .env ni database.sqlite.

---

HP en personajes + subida puntos de raza:

- Migración add_hp_to_characters_table.php para hp_max y hp_current.
- Modelo Character actualizado con fillable hp_max y hp_current.
- Inicialización en creación: hp_max = race.base_hp, hp_current = hp_max.
- RaceSeeder actualizado: freemium stat_points_total 32, premium 42, admin 52; min_role 'user' para freemium.
- Modelo Race ya existía.

Archivos tocados:

- app/Models/Character.php
- app/Http/Controllers/CharacterController.php
- database/seeders/RaceSeeder.php

Comandos ejecutados:

- php artisan test || true
- php artisan route:list
- php artisan optimize:clear

Verificación:

- Tests pasan salvo errores de BD previos (índice duplicado).
- Rutas OK.
- Caché limpiado.

No se tocó .env ni database.sqlite.

---

Pociones en inventario (cura total + buff 1 misión):

- Migración character_potion_effects_table para bloquear usos por misión (heal_lock, stat_boost).
- Service PotionService con métodos useHealingPotion y useStatPotion.
- Controller PotionController y ruta POST /game/inventario/pociones/usar/{item}.
- Modelo CharacterPotionEffect.
- Pociones añadidas a ShopItemsSeeder (curación + 4 stats).
- UI sección pociones en inventario con botones usar.
- Restricciones: 1 curación/misión, 1 stat activa.

Archivos tocados:

- database/migrations/2026_01_30_000000_create_character_potion_effects_table.php
- app/Services/PotionService.php
- app/Http/Controllers/PotionController.php
- app/Models/CharacterPotionEffect.php
- routes/web.php
- database/seeders/ShopItemsSeeder.php
- resources/views/game/inventario.blade.php

Comandos ejecutados:

- php artisan route:list (error por WelcomeController faltante)
- npm run build (OK)

Verificación:

- Build OK.
- Rutas: error por controller faltante, pero nuestra ruta no se lista por eso.

Pendiente: multiplicador de nivel sobre stats base y cómo afecta a hp_max y daño.

Pendiente: al finalizar una misión o un combate (duelo/pelea), la vida se cura automáticamente (hp_current = hp_max).

No se tocó .env ni database.sqlite.

---

Perfil full-screen desktop + proporciones mobile + HP/stats en personajes + seeders completados + fix inventario:

- Perfil: layout ocupa toda la pantalla en desktop (>=992px) sin scroll, viéndose como app equilibrada. En mobile, proporciones 25% cuenta / 75% juego vertical.
- Personajes: barras de HP y puntos de stats mostrados en creador y perfil.
- Seeders: completados todos (AdminUser, Race, Mount, ShopItems).
- Inventario: corregido error de sintaxis Blade (unexpected else).
- CSS: perfil responsive con media queries.

Archivos tocados:

- app/Http/Controllers/GameProfileController.php
- resources/views/game/perfil.blade.php
- resources/views/game/character/create.blade.php
- resources/css/game/components/perfil.css
- database/seeders/ShopItemsSeeder.php
- database/seeders/AdminUserSeeder.php
- database/migrations/2026_01_29_153602_add_plan_to_users_table.php (eliminada duplicada)
- database/migrations/2026_01_23_091226_update_characters_structure.php
- resources/views/game/inventario.blade.php

Comandos ejecutados:

- git status --porcelain
- git branch --show-current
- git log --oneline -3
- php artisan view:clear
- php artisan db:seed --class=AdminUserSeeder
- php artisan db:seed
- php artisan migrate
- npm run build
- git add .
- git commit -m "..."

Verificación:

- Seeders ejecutados sin errores.
- Migraciones completadas.
- Vista inventario carga sin 500.
- Perfil ocupa full screen en desktop, compacto en mobile.
- HP y stats visibles en creador y perfil.

No se tocó .env ni database.sqlite.
