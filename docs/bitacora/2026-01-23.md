# Bitácora de Desarrollo - 2026-01-23

## Objetivo del Día

Implementar cimientos completos del sistema de personajes: BD, Modelos, Request, Controller y Rutas.
Debe quedar funcional la creación de personaje (1 por usuario) con validación de stats exactos y roles, e inicialización de equipamiento (slots vacíos) y montura.

## Checklist

- [ ] **Auditoría inicial**: Verificar estado actual de migraciones y modelos.
- [ ] **Migraciones**:
    - [ ] `races`: Añadir `min_role`, `stat_points_total`.
    - [ ] `game_classes` (Nueva): Crear tabla para Clases (`name`, `min_role`, etc.).
    - [ ] `characters`: Ajustar `user_id` (unique), añadir `class_id`, `stats_json`.
    - [ ] `inventory_and_equipment`: Ajustar `character_equipment` (item_id nullable, string slot), añadir `character_mount_equipment`.
- [ ] **Modelos**:
    - [ ] `Race`: Actualizar fillable y relaciones.
    - [ ] `GameClass`: Crear modelo y relaciones.
    - [ ] `Character`: Relaciones (User, Race, GameClass, Equipment, Mount), Casts (`stats_json`).
    - [ ] `Item`: Verificar relaciones.
    - [ ] `CharacterItem`: Crear modelo (Inventario).
    - [ ] `CharacterEquipment`: Actualizar (Slot como string).
    - [ ] `CharacterMountEquipment`: Crear modelo.
- [ ] **Lógica (Controller & Request)**:
    - [ ] `StoreCharacterRequest`: Validar `stats_json` (suma exacta), roles (`min_role`), unicidad de personaje.
    - [ ] `CharacterController`:
        - [ ] `create()`: Vista formulario.
        - [ ] `store()`: Crear personaje, inicializar slots vacíos en `character_equipment` y `character_mount_equipment`.
- [ ] **Rutas**: Registrar `/character/create` y `/character` (POST) en `web.php`.

## Decisiones Técnicas (Cerradas)

- **Unicidad**: 1 Personaje por User (`user_id` unique).
- **Borrado**: Irreversible (Sin SoftDeletes).
- **Slots Equipamiento**: `weapon`, `helmet`, `armor`, `ring`, `amulet`, `mount` (en `character_equipment`).
- **Slot Montura**: `mount_armor` (en `character_mount_equipment`).
- **Stats**: JSON en BD, validación de suma exacta vs `races.stat_points_total`.
- **Items**: Sin durabilidad, Quantity en todo el inventario.

## Comandos Ejecutados

(Se rellenará durante la ejecución)

## Actualización: Theming System

Hecho: sistema de theming dual implementado en landing-theme.css (claro "Crónica Antigua" + oscuro "Abismo").

Archivos:

public/css/landing-theme.css (actualizado con variables CSS duales)

Motivo: dualidad marcada entre fantasía inmersiva (claro) y grimdark funcional (oscuro), encaja con Warhammer/Juego de Tronos.

Pruebas: variables aplicadas, hover y transiciones OK en ambos modos.

## Actualización: Landing — Rediseño sección "Razas del Viejo Mundo"

Hecho:

- [x] Creado partial moderno `resources/views/guest/sections/_razas_grid.blade.php` con array local de razas (13 razas exactas, Demonios del Caos marcado premium).
- [x] Reemplazado include en `resources/views/guest/welcome.blade.php` para usar `@include('guest.sections._razas_grid')`.
- [x] Añadido CSS mínimo en `public/css/landing-theme.css` con clases: `.race-card`, `.race-avatar`, `.race-badge-corner`, `.race-title`, `.race-desc`, `.line-clamp-2`.
- [x] Ajustado badge "Premium" a esquina inferior-derecha y eliminado texto duplicado en pie de card.
- [x] Avatar circular con `object-fit: cover` y `alt` accesible por cada raza.
- [x] Eliminadas/neutralizadas vistas legacy (reemplazado `razas_del_viejo_mundo.blade.php` por un include al nuevo partial) y limpiado `_prologo_text.blade.php` para evitar duplicados.

Archivos tocados:

- `resources/views/guest/sections/_razas_grid.blade.php` (nuevo/edición)
- `resources/views/guest/welcome.blade.php` (include actualizado)
- `resources/views/guest/sections/razas_del_viejo_mundo.blade.php` (reemplazado por include al nuevo partial)
- `resources/views/guest/sections/_prologo_text.blade.php` (truncado, placeholder)
- `public/css/landing-theme.css` (estilos de las cards y badge)

Comandos ejecutados:

```bash
npm run build
php artisan view:clear
php artisan cache:clear
php artisan route:clear
php artisan config:clear
```

Resultado:

- Landing ahora incluye la rejilla moderna de razas; la presentación es compacta y responsive (1/2/3/4 columnas según breakpoint).
- Badge premium visible en esquina inferior, sin duplicados.
- Caché de vistas limpiada para asegurar render actualizado.

Próximo paso:

- Ajustes de tamaño de badge o separación en móviles si el badge aún interfiere con contenido (puedo aplicarlo ahora si confirmas).

### 2026-01-23 (tarde) — Ajuste UI: badge Premium en cards de razas

Objetivo:

- Evitar que el badge "Premium" solape el título o el avatar en las cards de razas. Debe actuar como sello en la esquina inferior-derecha.

Cambios realizados:

- `resources/views/guest/sections/_razas_grid.blade.php` — reorganizado markup: la card usa `article.race-card.card` con `img.race-avatar` absoluta en esquina inferior-izquierda y `div.card-body` con `padding-bottom` reservado.
- `public/css/landing-theme.css` — añadidas reglas y variables: `--race-avatar-size`, `.race-card .card-body { padding-bottom:56px }`, `.race-avatar { position:absolute; left:14px; bottom:14px; width:var(--race-avatar-size); }`, `.race-badge-corner { position:absolute; right:12px; bottom:12px }`.

Decisiones UI / razones:

- Badge bottom-right: evita solapar el nombre y sigue patrón de "sello" visual. (Regla: badge absoluto, `right:12px; bottom:12px`).
- Avatar bottom-left: separa visualmente identidad (imagen) y evita chocar con badge. (Regla: `left:14px; bottom:14px; width:52px`).
- Reservar padding inferior en `.card-body` para garantizar que texto no quede debajo de elementos absolutos.

Próximo paso:

- Si lo deseas, pruebo en móvil reducido y ajusto `--race-avatar-size` o `right/bottom` para retirar solape en pantallas pequeñas.
