# Bitácora 2026-01-19: Separación de PLAN y ROL

## Objetivo

Separar claramente la lógica de suscripción (PLAN) de la lógica de permisos administrativos (ROL) y asegurar un usuario administrador robusto.

## Cambios Realizados

### 1. Estructura de Base de Datos

- **PLAN**: Se utiliza el campo `plan` existente (afectado por la migración previa). Valores: `free` y `premium`. Controla el acceso a contenido (razas, etc.).
- **ROL**: Se creó una nueva migración `add_role_to_users_table.php` que añade la columna `role` (string, default: `user`) a la tabla `users`. Controla permisos de acceso al panel de administración.

### 2. Seeder Robusto (AdminUserSeeder)

- Se actualizó `AdminUserSeeder.php` para ser totalmente idempotente.
- **Lógica**:
    - Busca al usuario por email (`admin@valtherion.local`).
    - Si es nuevo, asigna una contraseña por defecto (`12345678`).
    - Si ya existe, **NO** toca la contraseña para evitar sobrescribir cambios manuales.
    - Asegura siempre: `name = 'Admin Valtherion Leal'`, `plan = 'premium'` y `role = 'admin'`.

### 3. Verificación

- **Tinker**: Se ejecutó `php artisan tinker` para comprobar que el usuario existe con los valores correctos.
- **BD**: Comprobado en BD (SQLite) que la estructura refleja ambos campos por separado.
    - `plan`: premium
    - `role`: admin

## Comandos Ejecutados

```bash
php artisan make:migration add_role_to_users_table --table=users
php artisan migrate
php artisan db:seed
```

## Resultado Final

- **PLAN**: free/premium (contenido)
- **ROL**: user/admin (permisos)
- El usuario admin está configurado como `premium` y `admin` de forma segura.

## Siguientes Pasos

- Implementar middlewares que verifiquen tanto el `role` (para admin) como el `plan` (para contenido premium).
